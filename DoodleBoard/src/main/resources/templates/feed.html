<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Doodle Board - Feed</title>
    <div th:replace="fragments/base :: headWithoutTitleP5"></div>
</head>
<body class="bg-light">
    <div th:replace="fragments/base :: topNavBar"></div>

    <h2 class="mt-2 text-center p-2" th:text="${'Hi, ' + username + '!'}">Hello, Placeholder!</h2>
    <h1 class="mt-2 text-center p-2">Your Submissions</h1>

    <!-- Hidden input element which stores the palette list received from the Model in value attribute -->
    <input type="hidden" th:value="${palette}" id="plt"/>

    <input type="hidden" id="currEditing" value=""/>

    <!--Div for each post in the feed-->
    <div class="feedpost bg-white p-4 p-lg-5 mt-5 mb-5 col-10 offset-1 col-md-8 offset-md-2 col-lg-4 offset-lg-4"
         th:each="post: ${posts}">
        <!--Adding a regular canvas to each post-->
        <canvas class="doodleCanvas p-0 col-12" style=""></canvas>
        <input type="hidden" class="drawingStr" th:id="'str_' + ${post.getPostId()}" th:value="${post.content.data}"/>
        <div class="container-fluid p-1 row ml-0 mt-2">

            <b th:text="${post.title}"
               th:id="'title_' + ${post.getPostId()}"
               class="p-0 mt-auto mb-auto col-12 col-md-4">Title of Doodle</b>

            <div class="container-fluid col-12 col-md-8 p-0 m-0 row justify-content-md-end">

                <a class="btn btn-outline-primary col-auto mr-2 mb-2"
                   href="#"
                   th:onclick="'showViewRegion();' +
                                '$(\'#currEditing\').val(' + ${post.getPostId()} + ');'+
                                'setDrawingStr(); '">üëÅÔ∏è View</a>

                <a class="btn btn-outline-primary col-auto mr-2 mb-2"
                   href="#"
                   th:onclick="'showEditRegion();' +
                                '$(\'#currEditing\').val(' + ${post.getPostId()} + ');'+
                                '$(\'#drawingForm\').attr(\'action\',\'/edit/' + ${post.getPostId()} + '\');' +
                                'setDrawingStr(); '"
                >‚úèÔ∏è Edit</a>

                <a class="btn btn-outline-danger col-auto mb-2"
                   href="#">üóëÔ∏è Delete</a>
            </div>
        </div>
    </div>

    <!--Div for the modal doodle editing form-->
    <div class="fixed-top w-100 h-100 editouter"
         style="background-color: rgba(0,0,0,0.5); display:none;"
         id="editouter">
        <div class="block editouter" style="height: 5%;"></div>
        <div class="bg-white block col-12 col-md-10 col-lg-8 offset-lg-2 offset-md-1 pt-1 rounded"
             style="height: 90%; border: 1px solid gray; overflow: scroll;"
             id="editregion">

            <form method="post"
                  id="drawingForm"
                  style="border: 1px solid gray; border-radius: 4px;"
                  class="justify-content-center container-fluid text-center bg-white col-12 col-md-11 p-md-2 mb-2"
                  th:action="@{/edit/{postid}(postid=${doodlepost.getPostId()})}"
                  th:object="${doodlepost}">

                <!-- div to contain canvas generated by p5js -->
                <div id="p5CanvasDiv" class="row justify-content-center text-center m-0 p-0 pt-4" style="height:auto;">
                    <!--P5 canvas will be inserted in here-->
                </div>

                <span class="text-danger row text-center justify-content-center mt-2"
                      th:if="${errors != null and errors.hasFieldErrors('content.data')}"
                      th:text="${errors.getFieldError('content.data').getDefaultMessage()}">Drawing Error</span>
                <!-- Hidden input element which will store the drawing String in its value attribute -->
                <input type="hidden" th:field="*{content.data}" id="drawingStr" />


                <span class="row text-danger col-12 text-center justify-content-center mt-3 mb-0"
                      th:if="${errors != null and errors.hasFieldErrors('title')}"
                      th:text="${errors.getFieldError('title').getDefaultMessage()}">Title Error</span>
                <!-- Text input to store title of the doodle -->
                <input class="form-control row col-10 offset-1 text-center justify-content-center mt-3"
                       type="text"
                       size="40"
                       placeholder="Enter Title"
                       th:field="*{title}" id="dtitle"/>


                <button class="btn btn-outline-primary mt-3 mb-4"
                        id="submitBtn">Update Doodle</button>
                <a class="btn btn-outline-danger mt-3 mb-4 ml-2" href="#" onclick="hideEditRegion();">Cancel</a>
            </form>
        </div>
    </div>

    <!--Div for the modal doodle viewing-->
    <div class="fixed-top w-100 h-100 viewouter"
         style="background-color: rgba(0,0,0,0.5); display: none;"
         id="viewouter">
        <div class="block viewouter" style="height: 5%;"></div>
        <div class="bg-white block col-12 col-md-10 col-lg-8 offset-lg-2 offset-md-1 pt-1 rounded"
             style="height: 90%; border: 1px solid gray; overflow: scroll;" id="viewregion">
            testing
        </div>
    </div>

    <!--Div for the modal doodle delete-->

    <footer th:replace="fragments/base :: footernormal"></footer>

    <div th:replace="fragments/base :: scripts"></div>
    <!-- p5js running script -->
    <script th:src="@{/scripts/draw_script.js}"></script>
    <!-- feed elements sizing & placing script -->
    <script th:src="@{/scripts/feed_script.js}"></script>

    <script th:if="${hasError}">
        showEditRegion();
    </script>

</body>
</html>